<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sport Registry Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <nav class="bg-white shadow mb-4">
    <div class="container mx-auto px-4 py-2 flex space-x-4">
      <button data-resource="sports" class="nav-btn font-medium hover:text-blue-600">Sports</button>
      <button data-resource="countries" class="nav-btn font-medium hover:text-blue-600">Countries</button>
      <button data-resource="locations" class="nav-btn font-medium hover:text-blue-600">Locations</button>
      <button data-resource="competition-teams" class="nav-btn font-medium hover:text-blue-600">Competition Teams</button>
      <button data-resource="team-achievements" class="nav-btn font-medium hover:text-blue-600">Achievements</button>
    </div>
  </nav>

  <main class="container mx-auto px-4">
    <section id="resource-view">
      <!-- dynamic content -->
    </section>
  </main>

  <script>
    const apiBase = 'http://localhost:8080';
    const view = document.getElementById('resource-view');

    // render list and form for a resource
    async function loadResource(name) {
      view.innerHTML = `<h2 class="text-xl font-bold mb-4 capitalize">${name}</h2>`;
      const listUrl = `${apiBase}/${name}`;
      const createUrl = `${apiBase}/${name}`;

      // fetch list
      try {
        const res = await axios.get(listUrl);
        const items = res.data.data || res.data;
        const table = document.createElement('table');
        table.className = 'min-w-full bg-white rounded shadow mb-4';
        // headers
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        if (items.length) {
          Object.keys(items[0]).forEach(key => {
            const th = document.createElement('th');
            th.className = 'px-4 py-2 text-left'; th.textContent = key;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          table.appendChild(thead);

          // body
          const tbody = document.createElement('tbody');
          items.forEach(item => {
            const row = document.createElement('tr');
            Object.values(item).forEach(val => {
              const td = document.createElement('td');
              td.className = 'border-t px-4 py-2'; td.textContent = val;
              row.appendChild(td);
            });
            tbody.appendChild(row);
          });
          table.appendChild(tbody);
        } else {
          table.innerHTML = '<tr><td class="px-4 py-2">No records</td></tr>';
        }
        view.appendChild(table);

        // form for creation
        view.insertAdjacentHTML('beforeend', `
          <h3 class="text-lg font-semibold mb-2">Create new ${name.slice(0, -1)}</h3>
          <form id="create-form" class="space-y-2 mb-8">
            <!-- fields injected -->
            <div><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Submit</button></div>
          </form>
        `);
        const form = document.getElementById('create-form');
        // build inputs from schema: fetch one empty item and render
        let sample = items[0] || {};
        // remove id, system fields
        ['id','created_at','updated_at','record_hash','tx_hash'].forEach(f => delete sample[f]);
        Object.entries(sample).forEach(([key, val]) => {
          const type = typeof val === 'number' ? 'number' : 'text';
          const input = document.createElement('input');
          input.name = key;
          input.placeholder = key;
          input.type = type;
          input.className = 'block w-full border rounded px-2 py-1';
          form.insertBefore(input, form.firstChild);
        });

        form.onsubmit = async e => {
          e.preventDefault();
          const data = {};
          new FormData(form).forEach((v,k)=> data[k]= v);
          try {
            await axios.post(createUrl, data);
            loadResource(name);
          } catch(err) {
            alert('Error: '+ err);
          }
        };

      } catch(err) {
        view.innerHTML = `<p class="text-red-600">Failed to load ${name}: ${err}</p>`;
      }
    }

    // nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.onclick = () => loadResource(btn.dataset.resource);
    });

    // load default
    loadResource('sports');
  </script>
</body>
</html>
